import{a as O}from"./axios-zw96FDk0.js";/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var w=y,p=C,k=Object.prototype.toString,f=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function y(e,n){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var i={},t=n||{},r=t.decode||S,o=0;o<e.length;){var s=e.indexOf("=",o);if(s===-1)break;var a=e.indexOf(";",o);if(a===-1)a=e.length;else if(a<s){o=e.lastIndexOf(";",s-1)+1;continue}var c=e.slice(o,s).trim();if(i[c]===void 0){var h=e.slice(s+1,a).trim();h.charCodeAt(0)===34&&(h=h.slice(1,-1)),i[c]=E(h,r)}o=a+1}return i}function C(e,n,i){var t=i||{},r=t.encode||v;if(typeof r!="function")throw new TypeError("option encode is invalid");if(!f.test(e))throw new TypeError("argument name is invalid");var o=r(n);if(o&&!f.test(o))throw new TypeError("argument val is invalid");var s=e+"="+o;if(t.maxAge!=null){var a=t.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(a)}if(t.domain){if(!f.test(t.domain))throw new TypeError("option domain is invalid");s+="; Domain="+t.domain}if(t.path){if(!f.test(t.path))throw new TypeError("option path is invalid");s+="; Path="+t.path}if(t.expires){var c=t.expires;if(!_(c)||isNaN(c.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+c.toUTCString()}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.partitioned&&(s+="; Partitioned"),t.priority){var h=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(h){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var m=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(m){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}function S(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function v(e){return encodeURIComponent(e)}function _(e){return k.call(e)==="[object Date]"||e instanceof Date}function E(e,n){try{return n(e)}catch{return e}}function b(){const e=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof e=="boolean"?e:typeof document=="object"&&typeof document.cookie=="string"}function T(e){return typeof e=="string"?w(e):typeof e=="object"&&e!==null?e:{}}function u(e,n={}){const i=A(e);if(!n.doNotParse)try{return JSON.parse(i)}catch{}return e}function A(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}class j{constructor(n,i={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const r=this.cookies;this.cookies=w(document.cookie),this._checkChanges(r)};const t=typeof document>"u"?"":document.cookie;this.cookies=T(n||t),this.defaultSetOptions=i,this.HAS_DOCUMENT_COOKIE=b()}_emitChange(n){for(let i=0;i<this.changeListeners.length;++i)this.changeListeners[i](n)}_checkChanges(n){new Set(Object.keys(n).concat(Object.keys(this.cookies))).forEach(t=>{n[t]!==this.cookies[t]&&this._emitChange({name:t,value:u(this.cookies[t])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(n,i={}){return i.doNotUpdate||this.update(),u(this.cookies[n],i)}getAll(n={}){n.doNotUpdate||this.update();const i={};for(let t in this.cookies)i[t]=u(this.cookies[t],n);return i}set(n,i,t){t?t=Object.assign(Object.assign({},this.defaultSetOptions),t):t=this.defaultSetOptions;const r=typeof i=="string"?i:JSON.stringify(i);this.cookies=Object.assign(Object.assign({},this.cookies),{[n]:r}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=p(n,r,t)),this._emitChange({name:n,value:i,options:t})}remove(n,i){const t=i=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),i),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[n],this.HAS_DOCUMENT_COOKIE&&(document.cookie=p(n,"",t)),this._emitChange({name:n,value:void 0,options:i})}addChangeListener(n){this.changeListeners.push(n),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(n){const i=this.changeListeners.indexOf(n);i>=0&&this.changeListeners.splice(i,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const d=new j,g=d.get("adminAccessToken"),L="/",l=O.create({baseURL:L,withCredentials:!0});l.interceptors.request.use(e=>g?(e.headers.Authorization=`Bearer ${g}`,e):new Promise(n=>{const i=setInterval(()=>{const t=d.get("adminAccessToken");t&&(clearInterval(i),e.headers.Authorization=`Bearer ${t}`,n(e))},100)}));l.interceptors.response.use(e=>e,async e=>{const n=e.config;if(e.response.status===401&&e.config&&!n._isRetry){n._isRetry=!0;try{const i=await O.get("http://216.250.11.9:5005/api/admin/auth/refresh",{withCredentials:!0});return e.response.config.headers&&(e.response.config.headers.Authorization=i.data.accessToken),d.set("adminAccessToken",i.data.accessToken),l.request(n)}catch{console.log("НЕ АВТОРИЗОВАН")}}throw e});export{l as $};
